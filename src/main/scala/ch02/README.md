# 리팩터링 원칙

## 2.1 리팩터링 정의

리팩터링은 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법이다.

## 2.2 두 개의 모자

리팩터링을 설명할 때는 두 가지 모자를 쓴다. 하나는 '기능을 추가할 때' 쓰는 모자고, 다른 하나는 '리팩터링할 때' 쓰는 모자다. 이 두 모자를 명확하게 구분해야 한다. 기능을 추가할 때는 코드를 추가하고,
리팩터링할 때는 코드를 수정한다. 두 작업을 동시에 하면 안 된다.

## 2.3 리팩터링하는 이유

리팩터링을 하는 이유는 다양하다. 가장 중요한 이유는 코드를 이해하고 수정하기 쉽게 만들기 위해서다. 코드를 이해하기 쉽다면 버그를 찾고 수정하기도 쉬워진다. 또한 코드를 이해하기 쉬우면 새 기능을 추가하기도
쉬워진다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다. 코드를 이해하기 어렵다면 버그를 찾기 어렵다. 코드를 이해하기 어렵다면 버그를 수정하기 어렵다. 코드를
이해하기 어렵다면 새 기능을 추가하기 어렵다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을
방법을 찾기 어렵다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다.
코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다. 코드를 이해하기 어렵다면 새 기능을 추가할 때 기존 코드를 건드리지 않을 방법을 찾기 어렵다. 코드를 이해하기 어렵

## 2.4 언제 리팩터링해야 할까?

리팩터링을 하려면 먼저 리팩터링할 코드에 대한 테스트부터 마련해야 한다. 테스트는 리팩터링하는 동안 시스템이 여전히 제대로 동작하는지 확인해준다. 테스트를 마련했다면 언제든지 리팩터링할 수 있다. 리팩터링할 코드에
대한 테스트를 마련하지 않았다면 리팩터링을 시작하기 전에 테스트부터 마련하자.

## 2.5 리팩터링 시 고려할 문제

### 새 기능 개발 속도 저하

리팩터링의 궁극적인 목적은 개발 속도를 높이는 데 있다.
리팩터링을 더 자주 하도록 노력해야 한다(과도하게 하는 경우보다 거의 하지 ㅇ낳는 경우가 훨씬 많다).
본질은 경제적인 이유로 하는 것이다.

### 코드 소유권

코드의 소유권은 팀에 둔다.

### 브랜치

독립 브랜치로 작업하는 기간이 길어길수록 통합하기 어려워진다.
CI에 따르면 모든 팀원이 하루에 최소 한 번은 마스터와 통합한다.
마스터를 건강하게 유지하고, 거대한 기능을 잘게 쪼개는 법을 배오고, 각 기능을 끌 수 있는 기능 토글을 적용하여 미완료 기능이 시스템을 망치지 않도록 한다.
CI를 완벽히 적용하지 못하더라도 **통합 주기만큼**은 최대한 짧게 잡아야 한다.

### 테스팅

핵심은 오류를 재빨리 잡는 데 있다. 그리고 이를 빠르게 실행할 수 있어야 수시로 테스트하는 데 부담이 없다.
어느정도 테스트에 노력을 기울여야 하지만, 효과는 상당하다.

### 레거시 코드

대규모 레거시를 테스트 없이 리팩터링하는 것은 불가능하다. 정답은 테스트 보강이다.
코드의 한 부분을 훑고 넘어갈 때마다 예전보다 조금이라도 개선하려고 노력한다.

## 2.6 리팩터링, 아키텍처, 애그니(YAGNI)

소프트웨어 요구사항을 사전에 모두 파악해서 아키텍처를 확정짓는 방법은 불가능 할 때가 많다.
시간이 지나면서 사용자 요구사항을 더 잘 이해하게 되면 아키텍처도 그에 맞게 리펙터링해서 바꾼다.
복잡도를 높일 수 있는 **유연성 메커니즘**은 반드시 검증을 거친 후에 추가한다.

## 2.7 리팩터링과 소프트웨어 개발 프로세스

리펙터링의 첫 번째 토대는 자가 테스트 고드이다.

## 2.8 리팩터링과 성능

리펙터링하면 소프트웨어가 느려질 수도 있다. 하지만 그와 동시에 성능을 튜닝하기는 더 쉬워진다.

## 2.9 리팩터링의 유래

리펙터링은 소프트웨어 개발에서 오랫동안 사용해온 기법이다. 그러나 이를 명시적으로 정리한 것은 비교적 최근에 이루어졌다.

## 2.10 리팩터링 자동화

리펙터링은 자동화할 수 있다. IDE나 특수한 리펙터링 도구를 사용하면 더 쉽게 리펙터링할 수 있다.

## 2.11 더 알고 싶다면

윌리엄 웨이크의 `리팩터링 워크북`
마이클 패더스의 `레거시 코드 활용 전략`



